# Aurion Kodi Skin - Project Status Report
**Date**: November 2, 2025  
**Current Version**: 21.2.2+omega.43 (Beta 43)  
**Status**: ⚠️ CRITICAL ISSUE - Menu Build Failure

---

## Project Overview

**Aurion** is a Kodi Omega (v21.x) skin forked from Estuary MOD V2 Omega, consisting of:
- `skin.aurion` - Main skin addon with custom theme and UI
- `plugin.video.aurion` - Companion video plugin
- `repository.aurion` - Custom addon repository hosted via GitHub Pages

**Repository**: https://github.com/OutrageousBean/Aurion  
**Hosting**: GitHub Pages at https://outrageousbean.github.io/Aurion/

---

## Current Critical Issue

### Symptom
**"Unable to build menu"** error from `script.skinshortcuts` addon when activating Aurion skin in Kodi.

### Root Cause Analysis
After extensive investigation (Betas 39-43), the issue is:

1. **Missing Generated File**: `script-skinshortcuts-includes.xml` is never created
   - This file should be auto-generated by script.skinshortcuts during menu build
   - File not existing means build fails BEFORE any code generation occurs

2. **PersonalWidget Templates**: The culprit appears to be PersonalWidget functionality
   - `shortcuts/template.xml` defines PersonalWidget templates
   - `shortcuts/overrides.xml` registers PersonalWidget widgets
   - `xml/Home.xml` previously had navigation to non-existent PersonalWidget controls (fixed in Beta 42)
   - Templates may be incompatible with script.skinshortcuts 2.0.3

3. **Script.skinshortcuts Version Conflict**:
   - Skin originally designed for script.skinshortcuts 1.1.6
   - Repository uses script.skinshortcuts 2.0.3
   - Template syntax or behavior may have changed between versions

### What We've Tried

| Beta | Change | Result |
|------|--------|--------|
| 39 | Pinned script.skinshortcuts to 2.0.3, updated xbmc.gui dependency | ❌ Still failed |
| 40 | Commented out missing template includes in Home.xml (lines 73-75) | ❌ Still failed |
| 41 | Completely removed template include comments from Home.xml | ❌ Still failed |
| 42 | Removed orphaned PersonalWidget navigation (lines 1672-1673) | ❌ Still failed |
| 43 | **Disabled PersonalWidget widgets in overrides.xml** | ⏳ Testing |

---

## File Structure

```
Aurion/
├── addons/
│   ├── plugin.video.aurion/          # Video plugin addon
│   │   ├── addon.xml
│   │   └── main.py
│   └── skin.aurion/                  # Main skin addon
│       ├── addon.xml                 # Manifest (v21.2.2+omega.43)
│       ├── xml/                      # UI definitions
│       │   ├── Home.xml             # Main home window (2333 lines)
│       │   ├── Includes_Home.xml    # PersonalWidget includes
│       │   └── script-skinshortcuts.xml  # Config UI for skinshortcuts
│       ├── shortcuts/                # Menu definitions for skinshortcuts
│       │   ├── mainmenu.DATA.xml    # Main menu shortcuts
│       │   ├── overrides.xml        # Widget/background config
│       │   ├── template.xml         # PersonalWidget templates (424 lines)
│       │   └── *.DATA.xml           # Other menu data (13 files, all valid XML)
│       ├── colors/                   # 15 color themes
│       ├── language/                 # 15 languages
│       ├── media/                    # Theme assets (.xbt files)
│       └── themes/                   # curial/ and flat/ variants
├── repository.aurion/
│   └── addon.xml                     # Repository definition
├── tools/
│   └── build.py                      # Build script (generates zips)
├── docs/                             # GitHub Pages site
│   └── zips/                         # Addon packages
│       └── skin.aurion/
│           └── skin.aurion-21.2.2+omega.43.zip  # Latest (95MB)
└── DEBUGGING_GUIDE.md                # Kodi debug logging instructions
```

---

## Key Components

### Dependencies (addon.xml)
```xml
<requires>
  <import addon="xbmc.gui" version="5.17.0"/>  <!-- Kodi Omega -->
  <import addon="script.skinshortcuts" version="2.0.3"/>
  <import addon="script.skin.helper.service" version="1.1.50"/>
  <import addon="plugin.program.autocompletion" version="2.0.4"/>
  <import addon="resource.images.weathericons.white" version="0.0.7"/>
</requires>
```

### Skin Shortcuts Integration
- **Trigger**: `Home.xml` line 4: `RunScript(script.skinshortcuts,type=buildxml&mainmenuID=9000&group=mainmenu)`
- **Configuration**: `xml/script-skinshortcuts.xml` (UI for widget/background settings)
- **Data Files**: `shortcuts/*.DATA.xml` (all validated as well-formed XML)
- **Templates**: `shortcuts/template.xml` (defines PersonalWidget behavior)
- **Expected Output**: `xml/script-skinshortcuts-includes.xml` (NOT BEING CREATED)

### PersonalWidget Feature
Allows users to create custom widget layouts with:
- **PersonalWidgetList**: List-based custom widgets (control ID 22000)
- **PersonalWidgetPanel**: Panel-based custom widgets (control ID 23000)

**Files Involved**:
- `shortcuts/template.xml`: Lines 3-265 (PersonalWidgetList), 267-315 (PersonalWidgetPanel)
- `shortcuts/overrides.xml`: Lines 49-50 (widget registration), 390-391 (shortcuts)
- `xml/Includes_Home.xml`: Lines 513-849 (PersonalWidgetListCategories), 850-1095 (PersonalWidgetPanelCategories)
- `xml/script-skinshortcuts.xml`: Lines 202-426 (configuration UI)

**Status**: Disabled in Beta 43 for testing

---

## Build System

### Build Process
```bash
python3 tools/build.py
```
- Packages skin into `docs/zips/skin.aurion/skin.aurion-[version].zip`
- Generates `docs/addons.xml` and `docs/addons.xml.md5`
- Creates `docs/index.html` and category indexes

### Repository Cleanup (Beta 40)
- **Before**: 13 versions (omega.27-38), 1.1GB total
- **After**: 1 version (omega.43), 95MB
- **Reason**: GitHub Pages 1GB upload limit

### Version History
- omega.27-37: Deleted during cleanup
- omega.38: Deleted during cleanup
- **omega.39**: Pinned script.skinshortcuts 2.0.3
- **omega.40**: Commented out template includes
- **omega.41**: Removed template comments
- **omega.42**: Removed PersonalWidget navigation
- **omega.43**: Disabled PersonalWidget widgets (current)

---

## Investigation Findings

### What Works ✅
- All 13 shortcuts/*.xml files are valid XML
- All PersonalWidget includes exist in Includes_Home.xml
- Git repository builds successfully
- GitHub Pages deployment succeeds
- Other widgets (Movies, TV Shows, Music, etc.) are properly configured

### What's Broken ❌
- script.skinshortcuts cannot build menu
- script-skinshortcuts-includes.xml never gets created
- Error occurs at script.skinshortcuts level, not in Kodi's main log
- No entries in Kodi Event Log
- Kodi log file not found at expected location (C:\Users\ben\AppData\Roaming\Kodi\kodi.log)

### Evidence
```bash
# Template includes DO exist:
grep -r "PersonalWidgetListCategoriesBig" xml/
# xml/Includes_Home.xml:513:  <include name="PersonalWidgetListCategoriesBig">

# But template references them in shortcuts/template.xml:
# Line 186: <include condition="!Skin.HasSetting(UseSmallerCategories)">PersonalWidgetListCategoriesBig</include>

# Controls 22000 and 23000 do NOT exist in Home.xml:
grep "id=.22000\|id=.23000" xml/Home.xml
# No matches

# Generated includes file does NOT exist:
ls xml/script-skinshortcuts-includes.xml
# File not found
```

---

## Next Steps

### Immediate (Testing Beta 43)
1. ✅ Deploy Beta 43 with PersonalWidget disabled
2. ⏳ Test if menu builds successfully without PersonalWidget
3. ⏳ Check if script-skinshortcuts-includes.xml gets created

### If Beta 43 Works
PersonalWidget is confirmed as the issue. Options:
1. **Remove PersonalWidget entirely** (simplest, loses functionality)
2. **Rewrite template.xml** for script.skinshortcuts 2.0.3 compatibility
3. **Downgrade to script.skinshortcuts 1.1.6** (requires repo change)
4. **Contact script.skinshortcuts maintainer** for template format guidance

### If Beta 43 Fails
Deeper issue with script.skinshortcuts integration. Must:
1. Enable Kodi debug logging (see DEBUGGING_GUIDE.md)
2. Capture actual error from script.skinshortcuts
3. Compare with working Estuary MOD V2 Omega skin
4. Consider forking/embedding script.skinshortcuts for debugging

### Alternative Solutions
1. **Rebase on newer Estuary MOD V2 Omega** (if updated for Kodi 21)
2. **Switch to different base skin** (Aeon Nox, Arctic Zephyr, etc.)
3. **Remove script.skinshortcuts dependency** and hard-code menus (major refactor)

---

## Development Environment

### Setup
- **OS**: Windows 11 with WSL (Ubuntu)
- **Kodi**: Version 21 Omega
- **Python**: 3.x in WSL
- **Git**: SSH authentication (key: /home/ben/.ssh/id_ed25519)
- **IDE**: VS Code

### Commands
```bash
# Build
cd /mnt/c/Users/ben/OneDrive/Documents/GitHub/Aurion
python3 tools/build.py

# Validate XML
python3 -c "import xml.etree.ElementTree as ET; ET.parse('path/to/file.xml')"

# Deploy
git add -A
git commit -m "message"
git push  # Requires SSH passphrase entry
```

---

## Resources

### Documentation Read
- Kodi Wiki: Add-on development, Add-on structure, Skinning
- Script.skinshortcuts: GitHub repo (MikeSiLVO/script.skinshortcuts v2.0.3)
- Getting Started guides reviewed

### Known Issues
- **No debug log output**: Kodi log file not accessible or not created
- **No Event Log entries**: Error doesn't appear in Kodi UI Event Log
- **SSH passphrase prompts**: Manual entry required for each git push

### Support Channels
- Kodi Forum: https://forum.kodi.tv/showthread.php?tid=178294 (Skin Shortcuts thread)
- GitHub Issues: https://github.com/MikeSiLVO/script.skinshortcuts/issues

---

## Critical Files to Monitor

| File | Purpose | Issues |
|------|---------|--------|
| `xml/Home.xml` | Main window, triggers menu build | Fixed in Betas 41-42 |
| `shortcuts/template.xml` | PersonalWidget definitions | Likely incompatible with 2.0.3 |
| `shortcuts/overrides.xml` | Widget registration | PersonalWidget disabled in Beta 43 |
| `xml/script-skinshortcuts-includes.xml` | Generated includes (OUTPUT) | **NEVER CREATED** |
| `addon.xml` | Dependencies and metadata | Updated in Beta 39 |

---

## Commit History (Recent)

```
de10060 - Aurion Beta 42 - Remove orphaned PersonalWidget navigation
2f6920d - Aurion Beta 41 - Completely remove missing template includes from Home.xml  
fb52063 - Fix: Comment out missing skinshortcuts templates and bump to Beta 40
257da76 - Pin script.skinshortcuts to 2.0.3 and bump version to 21.2.2+omega.39
684db31 - Add script.skinshortcuts 2.0.3 to repository for auto-installation
b1dd2bb - omega.37: move AurionHeaderBar outside group 2000 to fix skinshortcuts menu build
1267015 - Clean up old versions and rebuild repository
```

---

## Summary

**Current Status**: Beta 43 deployed with PersonalWidget disabled as diagnostic test. Awaiting results to determine if PersonalWidget templates are the root cause of the menu build failure. If confirmed, will need to either remove PersonalWidget functionality permanently or rewrite templates for script.skinshortcuts 2.0.3 compatibility.

**Blocker**: Cannot proceed with skin distribution until menu builds successfully in Kodi.

**Priority**: HIGH - Core functionality broken, skin unusable.
